import { useState } from "react";
import { Search, Filter, Plus, Calendar as CalendarIcon, Users, Hotel, MapPin } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { Calendar } from "@/components/ui/calendar";
import { mockReservations } from "@/lib/mockReservationData";

const Reservations = () => {
  const [searchTerm, setSearchTerm] = useState("");
  const [filterStatus, setFilterStatus] = useState("all");
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [showCalendar, setShowCalendar] = useState(false);

  const filteredReservations = mockReservations.filter(res => {
    const matchesSearch = res.voucherNo.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         res.leader.name.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesStatus = filterStatus === "all" || res.status === filterStatus;
    return matchesSearch && matchesStatus;
  });

  return (\n    <div className=\"space-y-6\" data-testid=\"reservations-page\">\n      {/* Header Actions */}\n      <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between\">\n        <div className=\"flex-1 flex flex-col sm:flex-row gap-3 w-full\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" />\n            <Input\n              placeholder=\"Voucher No veya Yolcu Ad\u0131...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"search-input\"\n            />\n          </div>\n          \n          <Select value={filterStatus} onValueChange={setFilterStatus}>\n            <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"status-filter\">\n              <Filter className=\"w-4 h-4 mr-2\" />\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">T\u00fcm Durumlar</SelectItem>\n              <SelectItem value=\"confirmed\">Onayland\u0131</SelectItem>\n              <SelectItem value=\"pending\">Bekliyor</SelectItem>\n              <SelectItem value=\"cancelled\">Ä°ptal</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Dialog open={showCalendar} onOpenChange={setShowCalendar}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"calendar-btn\">\n                <CalendarIcon className=\"w-4 h-4 mr-2\" />\n                Takvim\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-fit\">\n              <DialogHeader>\n                <DialogTitle>Rezervasyon Takvimi</DialogTitle>\n              </DialogHeader>\n              <Calendar\n                mode=\"single\"\n                selected={selectedDate}\n                onSelect={setSelectedDate}\n                className=\"rounded-md border\"\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Button \n          className=\"bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 text-white shadow-lg\"\n          data-testid=\"add-reservation-btn\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Yeni Rezervasyon\n        </Button>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl p-4 border border-slate-200 shadow-sm\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center\">\n              <CalendarIcon className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <p className=\"text-xs text-slate-500\">Toplam Rezervasyon</p>\n              <p className=\"text-2xl font-bold text-slate-800\">{mockReservations.length}</p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl p-4 border border-slate-200 shadow-sm\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center\">\n              <Users className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <p className=\"text-xs text-slate-500\">Toplam Yolcu</p>\n              <p className=\"text-2xl font-bold text-slate-800\">\n                {mockReservations.reduce((sum, res) => sum + res.pax, 0)}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl p-4 border border-slate-200 shadow-sm\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center\">\n              <Hotel className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <p className=\"text-xs text-slate-500\">Onayland\u0131</p>\n              <p className=\"text-2xl font-bold text-slate-800\">\n                {mockReservations.filter(r => r.status === 'confirmed').length}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl p-4 border border-slate-200 shadow-sm\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center\">\n              <MapPin className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <p className=\"text-xs text-slate-500\">Bekliyor</p>\n              <p className=\"text-2xl font-bold text-slate-800\">\n                {mockReservations.filter(r => r.status === 'pending').length}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Reservations Table */}\n      <div className=\"bg-white rounded-2xl border border-slate-200 shadow-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\" data-testid=\"reservations-table\">\n            <thead className=\"bg-slate-50 border-b border-slate-200\">\n              <tr>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">Voucher No</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">Yolcu Ad\u0131</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">\u00dcr\u00fcn</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">Otel</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">Geli\u015f</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">D\u00f6n\u00fc\u015f</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">PAX</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\">Durum</th>\n                <th className=\"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase\"></th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-100\">\n              {filteredReservations.map((reservation) => (\n                <tr \n                  key={reservation.id} \n                  className=\"hover:bg-slate-50 transition-colors\"\n                  data-testid={`reservation-row-${reservation.id}`}\n                >\n                  <td className=\"px-6 py-4\">\n                    <span className=\"font-semibold text-slate-800\">{reservation.voucherNo}</span>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <div>\n                      <p className=\"font-medium text-slate-800\">{reservation.leader.name}</p>\n                      <p className=\"text-xs text-slate-500\">{reservation.leader.passport}</p>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <div>\n                      <p className=\"font-medium text-slate-800\">{reservation.product.code}</p>\n                      <p className=\"text-xs text-slate-500\">{reservation.product.name}</p>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 text-slate-700\">{reservation.hotel}</td>\n                  <td className=\"px-6 py-4 text-slate-700\">{reservation.arrivalDate}</td>\n                  <td className=\"px-6 py-4 text-slate-700\">{reservation.departureDate}</td>\n                  <td className=\"px-6 py-4\">\n                    <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                      {reservation.pax}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                      reservation.status === 'confirmed' ? 'bg-green-100 text-green-800' :\n                      reservation.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :\n                      'bg-red-100 text-red-800'\n                    }`}>\n                      {reservation.status === 'confirmed' ? 'Onayland\u0131' :\n                       reservation.status === 'pending' ? 'Bekliyor' : '\u0130ptal'}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <Button variant=\"ghost\" size=\"sm\" data-testid={`view-btn-${reservation.id}`}>\n                      G\u00f6r\u00fcnt\u00fcle\n                    </Button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Reservations;\n